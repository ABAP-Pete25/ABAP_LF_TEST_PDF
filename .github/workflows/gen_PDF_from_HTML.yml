name: Generate full PDF from Just-the-docs

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  pdf:
    runs-on: ubuntu-latest

    steps:
      # 1️⃣ Checkout repository
      - name: Checkout repository
        uses: actions/checkout@v4

      # 2️⃣ Install patched wkhtmltopdf
      - name: Install patched wkhtmltopdf
        run: |
          sudo apt-get remove -y wkhtmltopdf
          wget https://github.com/wkhtmltopdf/wkhtmltopdf/releases/download/0.12.6-1/wkhtmltox_0.12.6-1.bionic_amd64.deb
          sudo dpkg -i wkhtmltox_0.12.6-1.bionic_amd64.deb
          sudo apt-get install -f -y  # fehlende Abhängigkeiten reparieren
          wkhtmltopdf --version  # prüfen

      # 3️⃣ Build PDF from all HTML pages
      - name: Generate PDF
        run: |
          mkdir -p output

          # Definiere die Reihenfolge der Seiten
          echo "_site/index.html" > pages.txt
          echo "_site/intro.html" >> pages.txt
          echo "_site/chapter1.html" >> pages.txt
          echo "_site/chapter2.html" >> pages.txt
          echo "_site/appendix.html" >> pages.txt

          # Alle Seiten zusammenführen + Header/Footer
          xargs wkhtmltopdf \
            --margin-top 20mm \
            --margin-bottom 20mm \
            --margin-left 20mm \
            --margin-right 20mm \
            --header-center "Projekt-Dokumentation" \
            --footer-left "Just-the-docs" \
            --footer-right "[page]" \
            <
